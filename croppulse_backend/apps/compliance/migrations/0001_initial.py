# Generated by Django 5.2.10 on 2026-02-09 14:43

import core.mixins.tenant_mixin
import django.core.validators
import django.db.models.deletion
import uuid
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('farmers', '0002_farmernote_alter_farmer_options_and_more'),
        ('farms', '0004_remove_farm_boundary_accuracy_meters_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='AuditLog',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('entity_type', models.CharField(choices=[('EXPORT_PASSPORT', 'Export Passport'), ('DEFORESTATION_CHECK', 'Deforestation Check'), ('COMPLIANCE_DOCUMENT', 'Compliance Document')], max_length=50)),
                ('entity_id', models.UUIDField()),
                ('user_id', models.CharField(max_length=255)),
                ('user_name', models.CharField(max_length=255)),
                ('user_role', models.CharField(blank=True, max_length=100, null=True)),
                ('action', models.CharField(choices=[('CREATE', 'Created'), ('UPDATE', 'Updated'), ('DELETE', 'Deleted'), ('VERIFY', 'Verified'), ('APPROVE', 'Approved'), ('REJECT', 'Rejected'), ('EXPORT', 'Exported'), ('BLOCKCHAIN_ANCHOR', 'Blockchain Anchored')], max_length=50)),
                ('changes', models.JSONField(default=dict, help_text='Before/after values for updates')),
                ('reason', models.TextField(blank=True, null=True)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.TextField(blank=True, null=True)),
                ('timestamp', models.DateTimeField(auto_now_add=True)),
            ],
            options={
                'verbose_name': 'Audit Log',
                'verbose_name_plural': 'Audit Logs',
                'db_table': 'audit_logs_compliance',
                'ordering': ['-timestamp'],
                'indexes': [models.Index(fields=['entity_type', 'entity_id'], name='audit_logs__entity__78cbf5_idx'), models.Index(fields=['-timestamp'], name='audit_logs__timesta_85156c_idx'), models.Index(fields=['user_id', '-timestamp'], name='audit_logs__user_id_64c02d_idx')],
            },
            bases=(core.mixins.tenant_mixin.TenantMixin, models.Model),
        ),
        migrations.CreateModel(
            name='ExportPassport',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('passport_id', models.CharField(db_index=True, max_length=50, unique=True)),
                ('dds_reference_number', models.CharField(db_index=True, help_text='Due Diligence Statement Reference Number', max_length=100, unique=True)),
                ('operator_name', models.CharField(default='Unknown', help_text='EU Operator/Trader Name', max_length=255)),
                ('operator_eori', models.CharField(blank=True, help_text='EORI Number', max_length=50, null=True)),
                ('commodity_type', models.CharField(choices=[('COFFEE', 'Coffee'), ('COCOA', 'Cocoa'), ('PALM_OIL', 'Palm Oil'), ('CATTLE', 'Cattle'), ('WOOD', 'Wood'), ('RUBBER', 'Rubber'), ('SOY', 'Soy')], default='COFFEE', max_length=50)),
                ('commodity_code', models.CharField(default='0000', help_text='CN/HS Code', max_length=20)),
                ('baseline_date', models.DateField(default='2020-12-31', help_text='EUDR baseline cutoff date')),
                ('deforestation_status', models.CharField(choices=[('CLEAR', 'Clear - No Deforestation'), ('UNDER_REVIEW', 'Under Review'), ('FLAGGED', 'Flagged - Deforestation Detected'), ('REMEDIATED', 'Remediated')], default='UNDER_REVIEW', max_length=50)),
                ('risk_level', models.CharField(choices=[('LOW', 'Low Risk'), ('STANDARD', 'Standard Risk'), ('HIGH', 'High Risk')], default='STANDARD', max_length=20)),
                ('satellite_proof_url', models.URLField(blank=True, max_length=500, null=True)),
                ('satellite_analysis_date', models.DateField(auto_now_add=True)),
                ('gps_coordinates', models.JSONField(default=list, help_text='Farm corner coordinates: [{lat, lng}, ...]')),
                ('centroid_latitude', models.DecimalField(decimal_places=7, default=0.0, max_digits=10)),
                ('centroid_longitude', models.DecimalField(decimal_places=7, default=0.0, max_digits=10)),
                ('farm_size_hectares', models.DecimalField(decimal_places=4, max_digits=10, validators=[django.core.validators.MinValueValidator(0.01)])),
                ('plot_area_sqm', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('land_ownership_verified', models.BooleanField(default=False)),
                ('land_tenure_type', models.CharField(blank=True, choices=[('FREEHOLD', 'Freehold'), ('LEASEHOLD', 'Leasehold'), ('CUSTOMARY', 'Customary Rights'), ('COMMUNAL', 'Communal Land'), ('COOPERATIVE', 'Cooperative')], max_length=50, null=True)),
                ('land_document_url', models.URLField(blank=True, max_length=500, null=True)),
                ('land_document_type', models.CharField(blank=True, choices=[('TITLE_DEED', 'Title Deed'), ('LEASE_AGREEMENT', 'Lease Agreement'), ('CUSTOMARY_CERT', 'Customary Certificate'), ('COOPERATIVE_CERT', 'Cooperative Certificate')], max_length=50, null=True)),
                ('harvest_season', models.CharField(blank=True, max_length=50, null=True)),
                ('estimated_production_kg', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True, validators=[django.core.validators.MinValueValidator(0)])),
                ('blockchain_hash', models.CharField(blank=True, db_index=True, max_length=66, null=True)),
                ('blockchain_network', models.CharField(blank=True, choices=[('ETHEREUM', 'Ethereum'), ('POLYGON', 'Polygon'), ('AVALANCHE', 'Avalanche'), ('CELO', 'Celo')], max_length=50, null=True)),
                ('blockchain_tx_hash', models.CharField(blank=True, max_length=66, null=True)),
                ('blockchain_timestamp', models.DateTimeField(blank=True, null=True)),
                ('audit_trail', models.JSONField(default=list, help_text='Chronological log of all verification steps and updates')),
                ('issued_date', models.DateField(auto_now_add=True)),
                ('valid_until', models.DateField(help_text='Passport expires after 1 year typically')),
                ('is_active', models.BooleanField(default=True)),
                ('is_verified', models.BooleanField(default=False)),
                ('verified_by', models.CharField(blank=True, max_length=255, null=True)),
                ('verified_date', models.DateTimeField(blank=True, null=True)),
                ('qr_code', models.ImageField(blank=True, null=True, upload_to='compliance/qr_codes/')),
                ('qr_data', models.JSONField(blank=True, help_text='Data encoded in QR code', null=True)),
                ('pdf_document', models.FileField(blank=True, null=True, upload_to='compliance/passports/')),
                ('language', models.CharField(choices=[('en', 'English'), ('fr', 'French'), ('de', 'German'), ('es', 'Spanish'), ('sw', 'Swahili')], default='en', max_length=10)),
                ('notes', models.TextField(blank=True, null=True)),
                ('internal_reference', models.CharField(blank=True, max_length=100, null=True)),
                ('farm', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='export_passports', to='farms.farm')),
                ('farmer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='export_passports', to='farmers.farmer')),
            ],
            options={
                'verbose_name': 'Export Passport',
                'verbose_name_plural': 'Export Passports',
                'db_table': 'export_passports',
                'ordering': ['-created_at'],
            },
            bases=(core.mixins.tenant_mixin.TenantMixin, models.Model),
        ),
        migrations.CreateModel(
            name='DeforestationCheck',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('check_date', models.DateField(auto_now_add=True)),
                ('check_type', models.CharField(choices=[('INITIAL', 'Initial Assessment'), ('PERIODIC', 'Periodic Review'), ('TRIGGERED', 'Alert-Triggered'), ('RENEWAL', 'Passport Renewal')], default='INITIAL', max_length=50)),
                ('analysis_start_date', models.DateField(help_text='Start of analysis period')),
                ('analysis_end_date', models.DateField(help_text='End of analysis period')),
                ('baseline_date', models.DateField(default='2020-12-31')),
                ('deforestation_detected', models.BooleanField(default=False)),
                ('forest_cover_percentage', models.FloatField(help_text='Current forest cover percentage', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('baseline_forest_cover', models.FloatField(blank=True, help_text='Forest cover at baseline date', null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('change_in_forest_cover', models.FloatField(help_text='Percentage point change (can be negative)')),
                ('forest_loss_hectares', models.DecimalField(blank=True, decimal_places=4, help_text='Estimated forest loss in hectares', max_digits=10, null=True)),
                ('satellite_provider', models.CharField(choices=[('SENTINEL2', 'Sentinel-2'), ('LANDSAT8', 'Landsat 8'), ('PLANET', 'Planet Labs'), ('GLOBAL_FOREST_WATCH', 'Global Forest Watch')], default='SENTINEL2', max_length=50)),
                ('satellite_imagery_urls', models.JSONField(default=list, help_text='URLs to satellite imagery used in analysis')),
                ('cloud_cover_percentage', models.FloatField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('ndvi_baseline', models.FloatField(blank=True, null=True)),
                ('ndvi_current', models.FloatField(blank=True, null=True)),
                ('ndvi_change', models.FloatField(blank=True, null=True)),
                ('risk_score', models.IntegerField(default=0, help_text='Deforestation risk score (0-100)', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('risk_factors', models.JSONField(default=list, help_text='List of identified risk factors')),
                ('status', models.CharField(choices=[('PENDING', 'Analysis Pending'), ('IN_PROGRESS', 'Analysis In Progress'), ('COMPLETED', 'Completed'), ('FAILED', 'Failed'), ('REQUIRES_REVIEW', 'Requires Manual Review')], default='PENDING', max_length=50)),
                ('result', models.CharField(blank=True, choices=[('CLEAR', 'Clear - No Deforestation'), ('WARNING', 'Warning - Minor Changes'), ('VIOLATION', 'Violation - Deforestation Detected'), ('INCONCLUSIVE', 'Inconclusive - Needs Review')], max_length=50, null=True)),
                ('analysis_method', models.CharField(blank=True, max_length=100, null=True)),
                ('confidence_score', models.FloatField(blank=True, help_text='Confidence in analysis result (0-1)', null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('analysis_metadata', models.JSONField(default=dict, help_text='Additional analysis parameters and results')),
                ('reviewed_by', models.CharField(blank=True, max_length=255, null=True)),
                ('reviewed_date', models.DateTimeField(blank=True, null=True)),
                ('reviewer_notes', models.TextField(blank=True, null=True)),
                ('evidence_urls', models.JSONField(default=list)),
                ('report_url', models.URLField(blank=True, max_length=500, null=True)),
                ('farm', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='deforestation_checks', to='farms.farm')),
                ('export_passport', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='deforestation_checks', to='compliance.exportpassport')),
            ],
            options={
                'verbose_name': 'Deforestation Check',
                'verbose_name_plural': 'Deforestation Checks',
                'db_table': 'deforestation_checks',
                'ordering': ['-check_date'],
            },
            bases=(core.mixins.tenant_mixin.TenantMixin, models.Model),
        ),
        migrations.CreateModel(
            name='ComplianceDocument',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('document_type', models.CharField(choices=[('LAND_TITLE', 'Land Title'), ('SATELLITE_REPORT', 'Satellite Analysis Report'), ('AUDIT_CERTIFICATE', 'Audit Certificate'), ('FARMERS_DECLARATION', "Farmer's Declaration"), ('PHOTO_EVIDENCE', 'Photo Evidence'), ('GPS_TRACE', 'GPS Trace'), ('OTHER', 'Other')], max_length=50)),
                ('document_name', models.CharField(max_length=255)),
                ('document_file', models.FileField(upload_to='compliance/documents/')),
                ('file_size_bytes', models.BigIntegerField(blank=True, null=True)),
                ('file_hash', models.CharField(blank=True, help_text='SHA-256 hash', max_length=64, null=True)),
                ('description', models.TextField(blank=True, null=True)),
                ('upload_date', models.DateTimeField(auto_now_add=True)),
                ('uploaded_by', models.CharField(max_length=255)),
                ('is_verified', models.BooleanField(default=False)),
                ('verified_by', models.CharField(blank=True, max_length=255, null=True)),
                ('verified_date', models.DateTimeField(blank=True, null=True)),
                ('export_passport', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='compliance.exportpassport')),
            ],
            options={
                'verbose_name': 'Compliance Document',
                'verbose_name_plural': 'Compliance Documents',
                'db_table': 'compliance_documents',
                'ordering': ['-upload_date'],
            },
            bases=(core.mixins.tenant_mixin.TenantMixin, models.Model),
        ),
        migrations.CreateModel(
            name='TranslationCache',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('source_language', models.CharField(max_length=10)),
                ('target_language', models.CharField(max_length=10)),
                ('source_text', models.TextField()),
                ('translated_text', models.TextField()),
                ('cache_key', models.CharField(db_index=True, max_length=64, unique=True)),
                ('hit_count', models.IntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('expires_at', models.DateTimeField()),
            ],
            options={
                'db_table': 'translation_cache',
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['cache_key'], name='translation_cache_k_da1ec9_idx'), models.Index(fields=['expires_at'], name='translation_expires_86386a_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='exportpassport',
            index=models.Index(fields=['farmer', '-issued_date'], name='export_pass_farmer__a97f19_idx'),
        ),
        migrations.AddIndex(
            model_name='exportpassport',
            index=models.Index(fields=['deforestation_status', 'is_active'], name='export_pass_defores_091aef_idx'),
        ),
        migrations.AddIndex(
            model_name='exportpassport',
            index=models.Index(fields=['dds_reference_number'], name='export_pass_dds_ref_a9d933_idx'),
        ),
        migrations.AddIndex(
            model_name='exportpassport',
            index=models.Index(fields=['blockchain_hash'], name='export_pass_blockch_4a1cd9_idx'),
        ),
        migrations.AddIndex(
            model_name='exportpassport',
            index=models.Index(fields=['-created_at'], name='export_pass_created_47c7b8_idx'),
        ),
        migrations.AddIndex(
            model_name='deforestationcheck',
            index=models.Index(fields=['farm', '-check_date'], name='deforestati_farm_id_10bc23_idx'),
        ),
        migrations.AddIndex(
            model_name='deforestationcheck',
            index=models.Index(fields=['status', 'result'], name='deforestati_status_1b14fa_idx'),
        ),
        migrations.AddIndex(
            model_name='deforestationcheck',
            index=models.Index(fields=['deforestation_detected'], name='deforestati_defores_b929db_idx'),
        ),
    ]
